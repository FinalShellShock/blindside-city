rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ── User profiles ──
    // Users can read/write their own profile doc.
    match /users/{uid} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }

    // ── League documents ──
    // Any authenticated user can read or write league docs.
    // (Commissioner/member enforcement is handled in app logic, not rules,
    //  because migrated users have legacy username keys rather than UIDs
    //  in the commissioners/users maps, making UID-based rule checks unreliable.)
    match /leagues/{leagueId} {
      allow read, write: if request.auth != null;

      // Draft subcollection — any league member can read/write draft state
      match /draft/{doc} {
        allow read: if request.auth != null;
        allow write: if request.auth != null;
      }
    }

    // ── Invite codes ──
    // Any authenticated user can read a code doc (to verify an invite code).
    // Any authenticated user can write a code doc (commissioner creating/regenerating).
    match /inviteCodes/{code} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
  }
}
